

module Msf
  class Exploit
    class Remote
      module HTTP
        # This module provides functions for implementing 
        # the HTTP-Trace functionality
        module Trace
          attr_accessor :ds_request
          attr_accessor :ds_response

          def initialize(info={})
            super

            register_advanced_options(
              [
                OptBool.new('HttpTrace', [ false, 'Show HTTP requests and responses', false ]),
                OptBool.new('HttpTraceHeadersOnly', [false, 'Show HTTP headers only in HttpTrace', false]),
                OptString.new('HttpTraceColors', [false, 'HTTP request and response colors for HttpTrace (unset to disable)', 'red/blu'])
              ], self.class
            )

          end
          
          def assign_proc_httptrace()
            http_client = Rex::Proto::Http::Client.new(datastore['RHOSTS'])
            if datastore['HttpTrace']
              self.ds_request = proc { |request| print_line("# Request ===== #{request}") }
              self.ds_response = proc { |response| print_line("# Response ==== #{response}") }
              http_client.set_procs_httptrace(@ds_request, @ds_response)
            else
              http_client.set_procs_httptrace(nil,nil)
            end
          end
        end
      end
    end
  end
end

